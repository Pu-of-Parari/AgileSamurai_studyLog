# 第三部：アジャイルな計画作り

## 第六章：ユーザーストーリーを集める

ユーザーストーリーを使った要求の集め方を知ることで、

- どうやって計画に最新の状況を反映し続けるのか
- どうやって計画には一番新鮮で信頼のおける情報だけを含めるようにするのか
- どうすれば時期尚早な事前分析を避けられるのか

ができるようになる。

### 文書化の難しさ

実際のソフトウェアプロジェクトでは、何を文書に書くべきかを話し合うことに多くの時間を費やしてしまっている。

ソフトウェアへの要求を表現する手段として文書に頼りすぎることの弊害は時間だけじゃない。

- 変化に対処できない
- 顧客の欲しいものに合わせるのではなく、仕様に合わせて作ることになる
- 下手な推測や誤った前提を招き寄せる
- 多くの時間を無駄にする

要求を文書として集めようとすることの問題点は、用意する文書量の多寡ではない。コミュニケーションに問題がある。文書と会話できるわけじゃないし、他の誰かが書いた文書はとても誤解を招きやすい。

**アジャイル開発の原則：**

> 情報を伝える最も効率的で効果的な方法はface to faceで話をすることです。

### そこでユーザーストーリー

ユーザーストーリーは顧客がソフトウェアで実現したいと思っているフィーチャを簡潔に記述したもの。記述するインデックスカードには完結にしか書かないので、詳細は顧客のところへ出向いて直に会話することを促進するという仕掛けになっている。

要求を収集するときの一番の目的は、フィーチャの本質をとらえるキーワードを書き留めておくこと。ありとあらゆる詳細を聞き出すことではない。ユーザーストーリーは「会話の約束」だと考える。しかるべき時が来たらその項目について詳細を検討するが、それは本当に必要だという確信を持てるようになってからの話。

### よくかけているユーザーストーリーとは

よくかけているユーザーストーリーの特徴

- 顧客にとって何かしらの価値が書かれていること
  - 「価値がある」：君のお客さんが対価を払ってもいいと思えること
  - ユーザーストーリーはビジネスの観点から評価できなきゃいけない。お客さんに理解できるシンプルな言葉遣いで書く。
  - 「データベースにコネクションプールを導入する」-> 「現状の10秒かかるページ読み込み速度を2秒まで縮める」
- エンドツーエンドになっていること
  - ケーキを切るようにスライスする
  - アーキテクチャのすべてのレイヤを貫いて、お客さんにとって価値のある成果を届けるようにする
- ストーリーが独立している
  - プロジェクトには変化がつきもの
  - 必ずしもストーリーを互いに独立させられるわけじゃないが、できるだけエンドツーエンドの切り口になったフィーチャ単位で切り分けることを意識する
  - 独立していれば必要に応じてスコープを柔軟に調整できるようになる
- 交渉の余地がある
  - 予算の範囲内に収まるようにある程度の融通が利くようにできるから
  - ストーリーによってはポルシェ級のものが必要になることもあれば、質素なフォードで間に合うものもある
- テストできる
  - テストできる＝どうなっていればちゃんと動いているのかがわかる
  - 開発チームにとっては作業範囲と仕事の官僚基準が明確になる
- 小さい、見積もれる
  - ストーリーを1-5日で完了できるサイズまで小さくしておけばイテレーションの範囲に収まりそうかどうかは確実にわかる

ユーザーストーリーと要件定義書・仕様書の特徴まとめ

| ユーザーストーリー                                           | 要件定義書と仕様書                                           |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| ・無駄がなく正確。必要な分を必要な時に<br />・対面でのコミュニケーションを促す<br />・計画がシンプル<br />・低コスト、素早く手軽<br />・最新の情報が反映される<br />・チームが学習することを踏まえている<br />・フィードバックを即時反映できる<br />・見積もり精度の高低に依らない<br />・チームの協調作業や新しい取り組みを歓迎する | ・重厚、不正確で最新じゃない<br />・憶測や誤った前提を招き寄せる<br />・計画が複雑<br />・コストがかさむ、遅い、手間がかかる<br />・情報が古くなったまま放置される<br />・チームが学習するといううことを考慮しない<br />・フィードバックを即時反映できない<br />・さも見積もり精度が高いかのように取り繕う<br />・オープンな協調作業や新しい取り組みを歓迎しない |

**ユーザーストーリーのテンプレート**

```
<ユーザーの種類>として、
<達成したいゴール>をしたい。
何故なら<理由>だからだ。
```

誰のためのストーリーで、何をしたいのか、なぜそうしたいのか

テンプレートを使うメリットとして、だれが、何を、なぜを明らかにできるし、ビジネスの視点に集中できるという点がある。デメリットとして、記述が冗長なので少しわかりづらいという点がある。テンプレートに従うもよし、短く簡潔にまとめるもよし。合わせ技もよし。



### ストーリー収集ワークショップを開こう

開発チーム、顧客が一緒になって開発対象のソフトウェアのユーザーストーリーを書いてみる。

ステップ

1. 大きく手見通しの良い部屋を用意する
   - 書いた図を張り出せる壁や、カードを並べておける大きなテーブルもあるとよい
2. 図をたくさん書く
   - ペルソナ(システムの想定ユーザーを表現したもの)
   - フローチャート、プロセスフロー
   - シナリオ
   - システム概要図
   - コンセプトデザイン
   - 絵コンテ　などなど
3. ユーザーストーリーをたくさん書く
   - 小さくて具体的なエンドツーエンドの機能を心がける(1-5日で実装できるサイズを目安に)
   - より大きなサイズのストーリーはエピックとして扱う
   - エピックはたぶんやらないといけないが本当に必要なのかはまだ確信が持てないものをくくりだしておくのにも便利
   - 1日かけて開催した場合で、ざっくりとしたストーリーを10-40挙げられれば十分。
4. その他もろもろをブレインストーミング
   - データ移行や負荷テスト、書類仕事、本番環境運用手順書やトレーニング教材の準備、検収期間など
   - プロジェクトのために必要なもろもろ全てをカードに書き留めておく
   - 他のストーリーと同じように優先順位をつけておく
5. リストを磨き上げる
   - 最初のマスターストーリーができたら、少し時間を取って眺めてみよう
   - もれなくダブりもない？
   - グループ分けできそうなストーリーはない？
   - お客さんにとって価値のある、シンプルでわかりやすいToDOリストになっている？

## 第七章：見積もり：当てずっぽうの奥義

### 概算見積もりの問題

プロジェクトの見積もりを取り巻く期待のマネジメントには課題がある。見積もりを未来の正確な予測だと思い込んでしまうことにある。

**概算見積もりなんて当てずっぽう**

事前見積もりを信じ切ってそのままプロジェクトを進めてしまうと、後になってその見積もりがプロジェクトを苦しめる、果たせない約束になってしまう。前もって見積もる時に、私たちが欲しい答えはただ一つ、**このプロジェクトをやり遂げられそうかどうか？**だけ。

そのために、次の3つの条件を満たすような見積もり手法が必要となる。

- 今後の計画を立てられる
- 見積もりは当てずっぽうだという前提を踏まえている
- ソフトウェア開発の複雑さを認めている

### ピンチをチャンスにする

何かを作る時にはそれがどれぐらいかかったかを計測して、それをもとに計画を立てる。計画を立てる上で踏まえるべきことは具体的に以下の２つ。

- ストーリーそれぞれを互いに相対的なサイズで見積もる
  - 過去に何度もやったことのある作業はX時間かかる。ならば、今回は...
  - 人間は相対的に見積もることは得意。
  - 注意：相対サイズ見積もりでの１日は実際のカレンダー上の１営業日とは必ずしも一緒じゃない問うことに留意しておく
- ポイントを基にして進捗を追跡する
  - 日数や時間で換算するのではなく「ポイント」で見積もってみる
    - １日の1.33倍＝1.33日　<- こんなの感覚的じゃない！
  - 見積もり結果の数値の単位には意味を持たせず、ただポイントとして表現することを推奨
  - 見積もりの数値と営業日の日数とを対応させないようにすることが狙い
  - 単位はなんでもいい。相対的な大きさの違いを表すことが重要。
  - ポイントで見積もることのメリット
    - 見積もりとは当てずっぽうであることを肝に銘じることができる
    - 見積もりとは純粋に大きさをはかるものだと考えられる
    - 手早く、気軽に、シンプルに見積もれる

### 見積もり技法

**三角測量**

代表的なストーリーをいくつか基準として選出して、残りのストーリーを基準になるストーリーとの相対サイズで見積もるやり方。

次のような視点からストーリーを眺め、基準となる代表的なストーリーを選定する。

- 論理的なグループ分けができそうなものはあるか？
- エンドツーエンドになっているストーリーはあるか？
- プロジェクトを象徴するような代表的なストーリーはどれか？

見積もりを進めていくうちに再見積もりすることになってもよい。明らかに見積もりが違うことがわかった場合は、見積もりの枠組みを見直して、もっと現実的な数字を割り当てなおすことになるのは当たり前。

これまでに経験がなくてサイズの検討がつかないストーリーに出くわした場合、「スパイク」を実践してみよう。スパイクとはタイムボックス化された実験のこと。ストーリーを見積もれるようになる程度に様々な調査を実施して、見積もったら止める(スパイクはあくまでも調査なので、ストーリーそのものは実装しない)。

**プランニングポーカー**

開発チームのメンバーは一つ一つのストーリーをまず自分自身で見積もる。見積もりの数値はカード(1, 3, 5)で見積もる。各人が見積もったらその数値をメンバー同士で見せ合って、チームとして統一した見積もりを出す。

いきなり初回でメンバー全員の意見が合致すればそれで決まり。食い違いがあればその違いについて話し合って再び各人が見積もる。チームで見積もり結果に合意ができるまで話し合いと再見積もりを繰り返す。

注意として、プランニングポーカーは投票システムではないということに留意しなければならない。3人の新米エンジニアの見積もりが1人の熟練エンジニアに「勝つ」仕組みではない。プランニングポーカーの狙いは個々人が三津からの見積もりについての意見を伝えあうことで、従来よりも適切な見積もりができるようになることにある。



## 第8章：現実と向き合う

本章では、信頼のおける計画の立て方、チームがコミットメントしたことをやり遂げるための方法を説明する。

### 固定された計画の問題

起こりうる想定外

- 主力チームメンバーが抜ける
- お客さんが自分たちの本当に欲しかったものに気づく
- 期日が早まる

このような事態はどんなプロジェクトでも起こりうる。こうした現実に立ち向かうためには、次の4つの基準を満たせるような計画の立て方を身につけなければならない。

- 顧客にとって価値ある成果を届けられる計画
- わかりやすくありのままを伝える、誠実な計画
- 約束したことを守り続けられる計画
- 必要に応じて変更できる計画

### アジャイルな計画作り

乱暴にまとめると、アジャイルな計画作りとはチームの開発速度を計測し、その速度をもとにプロジェクトの完了時期を見通せるようにすることでしかない。

**マスターストーリーリスト**

アジャイル開発では、プロジェクトでこなすべきToDoリストを「マスターストーリーリスト」と呼ぶ。リストには顧客がソフトウェアで実現したいと思っているありとあらゆるフィーチャを載せておく。

**ベロシティ**

アジャイルな計画作りでは、チームがユーザーストーリを動くソフトウェアに変換する速度のことを「ベロシティ」と呼ぶ。ベロシティはチームの生産性の計測と、プロジェクトの完了日の見通しを立てるのにつかわれる。

**イテレーション**

アジャイルプロジェクトで成果を上げていくエンジンになるのが「イテレーション」。イテレーションは1-2週間を全力疾走する短距離走みたいなもの。チームはこの期間を通じ、ユーザーストーリーをリリース可能な動くソフトウェアに変換する。

イテレーション数 = 作業量の合計 / チームの予想ベロシティ

注意として、最初のプロジェクト計画は厳格ではない。ただの当てずっぽうにすぎないということ。チームの本当のベロシティは始まってからじゃないとわからないため。イテレーションが開始されてやっと想定よりも早く進んでいるか遅く進んでいるかがわかる。

やるべきことが多すぎるという事態に直面したときは、**やることを減らす**。アジャイルチームは最初に立てた計画にいつまでもこだわるのではなく、計画の方を変える。そのときに普通はスコープを調整して対処する。



### スコープを柔軟に

スコープを柔軟にしておくこと。これこそがアジャイルプロジェクトで計画を誠実なものに保つための秘訣！

そのために、お客さんに強くお願いすべきこととして、新しいストーリーを追加するときには必ずどれか一つ既存のストーリーをマスターストーリーリストから削ってもらうようにする。これによって開発チームは顧客に要求変更の機会を提供しつつ、しかもスコープをプロジェクトで作業できる範囲内にとどめておくことができる。

**アジャイル開発の原則**

> 要求の変更はたとえ開発の後期であっても歓迎します。変化を味方につけることによって、お客様の競争力を引き上げます。

### 初回の計画づくり

- step1: マスターストーリーリストを作る
  - リストに顧客がソフトウェアで実現したいものを載せていく
  - 優先順位をつけて開発チームが見積もる。
  - 1-6か月程度の期間でこなせる仕事の範囲に収める
  - マスターストーリストからストーリーのサブセットを選び出してまとめておく(このまとまりをリリースと呼ぶ)
    - リリースはお客さんにとって意味のある単位でストーリーをまとめたもの
    - 1つのリリースはそのまとまりで実装し、本番環境にデプロイする価値があるように編成する
    - リリースの単位のことをMMF(Minimal Marketable Feature set)と呼ぶ
- step2: プロジェクトの規模を見極める
  - プロジェクトの規模とこれから始まる旅の長さの見通しを見極める
  - 「第7章当てずっぽうの奥義」を参考にしながら見積もってみる
- step3: 優先順位をつける
  - 一番重要なストーリーから順番に実装していく
  - 優先順位をつけるのは顧客の仕事。
  - 開発チームはアーキテクチャ上のリスクを低減できるストーリーを見極めその優先順位が高くなるように提案する
- step4: チームのベロシティを見積もる
  - チームのベロシティ = 完了させたストーリーポイントの合計 / イテレーション数
  - ベロシティ見積もりはイテレーションを3‐4回こなすことで安定してくる
  - 最初は憶測で構わない
  - 「完了の定義」も忘れずに共有する
    - コーディング、分析、テスト、設計などあらゆる作業が終わること
  - 最初は積極果敢なものにしすぎないのも肝心
- step5: 期日を借り決めする
  - 選択肢1:期日を固定する
    - 日付を特定して「この日が来たらプロダクトを何が何でもリリースします」と宣言してしまう。
    - 重要なストーリーが途中で新たに見つかったら、それと同サイズで、相対的に優先順位の劣るストーリーをスコープから外す
    - 厳しい決断とトレードオフを迫られることになる
    - 一方、程よい緊張感が生まれる
  - 選択肢2: フィーチャセットを固定する
    - 中核となるフィーチャのまとまりに含まれるフィーチャをすべて完成させるまでは作業を続ける作戦
    - フィーチャセットが明確にできるため、プロジェクトを進めやすくなる
    - 期日についてはある程度リスクを負うことになる



